<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Staff Roster Editor</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@latest/umd/lucide.js"></script>
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style for the scrollbar to be more subtle */
        .roster-container::-webkit-scrollbar {
            height: 8px;
        }
        .roster-container::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .roster-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .roster-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        /* Class for the element being dragged */
        .dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        /* Class for highlighting a valid drop zone */
        .drag-over {
            outline: 2px dashed #3b82f6;
            outline-offset: -2px;
            background-color: #eff6ff;
        }
        /* Grab cursor for draggable items */
        [draggable="true"] {
            cursor: grab;
        }
        [draggable="true"]:active {
            cursor: grabbing;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-screen-2xl mx-auto">
        <div class="p-6 bg-white rounded-xl shadow-lg mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">Weekly Roster Editor</h1>
                    <p id="roster-date-range" class="text-gray-500 mt-1"></p>
                </div>
                <div class="flex-shrink-0">
                    <label for="start-date-picker" class="block text-sm font-medium text-gray-700 mb-1">Start of Week</label>
                    <input type="date" id="start-date-picker" class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Staff Palette -->
            <aside class="lg:w-72 bg-white rounded-xl shadow-lg p-6 h-fit">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Staff Management</h2>
                <form id="add-staff-form" class="flex gap-2 mb-4">
                    <input type="text" id="new-staff-name" placeholder="Add new staff..." class="flex-grow p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                    <input type="color" id="new-staff-color" value="#a3a3a3" class="p-1 h-10 w-10 border border-gray-300 rounded-md cursor-pointer">
                    <button type="submit" class="bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                    </button>
                </form>
                <div id="staff-palette" class="space-y-3">
                    <!-- Draggable staff names will be generated here by JavaScript -->
                </div>
            </aside>

            <!-- Roster -->
            <main class="flex-1">
                <div class="w-full bg-white rounded-xl shadow-lg overflow-hidden">
                    <div id="roster-container" class="roster-container overflow-x-auto">
                        <!-- Roster will be generated here by JavaScript -->
                    </div>
                </div>
                <!-- Notes Section -->
                <div class="w-full bg-white rounded-xl shadow-lg overflow-hidden mt-8">
                     <h2 class="text-xl font-bold text-gray-800 p-6 border-b">Daily Notes</h2>
                    <div id="notes-container" class="grid grid-cols-1 md:grid-cols-7">
                        <!-- Notes textareas will be generated here -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- Data Model ---
        let staffMembers = [
            { name: 'Chrissy', color: '#60a5fa' },
            { name: 'Gemma', color: '#f87171' },
            { name: 'Jodie', color: '#4ade80' },
            { name: 'Niamh', color: '#fbbf24' },
            { name: 'Julie', color: '#a78bfa' },
            { name: 'MacKenzie', color: '#34d399' },
            { name: 'India', color: '#f472b6' },
            { name: 'Zack', color: '#fb923c' },
            { name: 'Charlie', color: '#2dd4bf' },
            { name: 'Else', color: '#a3a3a3' },
            { name: 'Simon', color: '#93c5fd' },
            { name: 'Alex', color: '#c084fc' }
        ];

        // Function to create an empty 20x7 grid
        const createEmptySchedule = () => Array.from({ length: 20 }, () => Array(7).fill(''));

        let rosterData = {
            startDate: '2025-04-21',
            schedule: createEmptySchedule(),
            notes: Array(7).fill('')
        };

        // --- State for Drag & Drop ---
        let draggedItem = null;

        // --- DOM Elements ---
        const staffPalette = document.getElementById('staff-palette');
        const rosterContainer = document.getElementById('roster-container');
        const notesContainer = document.getElementById('notes-container');
        const rosterDateRangeEl = document.getElementById('roster-date-range');
        const datePicker = document.getElementById('start-date-picker');
        const addStaffForm = document.getElementById('add-staff-form');
        const newStaffNameInput = document.getElementById('new-staff-name');
        const newStaffColorInput = document.getElementById('new-staff-color');

        // --- Helper Functions ---
        function getContrastingTextColor(hexcolor) {
            if (!hexcolor) return '#000000';
            hexcolor = hexcolor.replace("#", "");
            const r = parseInt(hexcolor.substr(0, 2), 16);
            const g = parseInt(hexcolor.substr(2, 2), 16);
            const b = parseInt(hexcolor.substr(4, 2), 16);
            const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return (yiq >= 128) ? '#1f2937' : '#ffffff'; // Using Tailwind gray-800 for black
        }
        
        // --- Main Render Function ---
        function render() {
            renderDateDisplay();
            renderStaffPalette();
            renderRosterGrid();
            renderNotes();
            lucide.createIcons();
        }

        function renderDateDisplay() {
            const startDate = new Date(rosterData.startDate + 'T00:00:00');
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            const dateFormatter = new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            rosterDateRangeEl.textContent = `${dateFormatter.format(startDate)} - ${dateFormatter.format(endDate)}`;
            datePicker.value = rosterData.startDate;
        }

        function renderStaffPalette() {
            staffPalette.innerHTML = ''; // Clear previous content
            staffMembers.forEach(staff => {
                const staffEl = createDraggableName(staff.name, 'palette');
                staffPalette.appendChild(staffEl);
            });
            const removeEl = createDraggableName('Remove', 'palette');
            staffPalette.appendChild(removeEl);
        }

        function renderRosterGrid() {
            rosterContainer.innerHTML = '';
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-7 min-w-[1200px]';
            
            const headerRow = createHeader();
            grid.appendChild(headerRow);
            
            rosterData.schedule.forEach((row, rowIndex) => {
                row.forEach((name, colIndex) => {
                    const cell = createDroppableCell(rowIndex, colIndex);
                    grid.appendChild(cell);
                });
            });
            rosterContainer.appendChild(grid);
        }

        function renderNotes() {
            notesContainer.innerHTML = '';
            for(let i = 0; i < 7; i++) {
                const noteWrapper = document.createElement('div');
                noteWrapper.className = 'p-4 border-b md:border-b-0 md:border-r border-gray-200';

                const textArea = document.createElement('textarea');
                textArea.className = 'w-full h-24 p-2 border border-gray-200 rounded-md resize-none focus:ring-blue-500 focus:border-blue-500';
                textArea.placeholder = `Notes for day ${i + 1}...`;
                textArea.value = rosterData.notes[i];
                textArea.addEventListener('input', (e) => {
                    rosterData.notes[i] = e.target.value;
                });
                
                noteWrapper.appendChild(textArea);
                notesContainer.appendChild(noteWrapper);
            }
        }

        // --- Element Creation Helpers ---
        function createHeader() {
            const headerRow = document.createElement('div');
            headerRow.className = 'col-span-7 grid grid-cols-7 sticky top-0 bg-white z-10';
            const startDate = new Date(rosterData.startDate + 'T00:00:00');
            const dayFormatter = new Intl.DateTimeFormat('en-US', { weekday: 'short', day: '2-digit', month: 'short' });
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                const parts = dayFormatter.formatToParts(currentDate);
                const weekday = parts.find(p => p.type === 'weekday').value;
                const day = parts.find(p => p.type === 'day').value;
                const month = parts.find(p => p.type === 'month').value;
                const dayCell = document.createElement('div');
                dayCell.className = 'text-center font-semibold text-gray-700 p-3 border-b-2 border-r border-gray-200';
                dayCell.textContent = `${weekday} ${day} ${month}`;
                headerRow.appendChild(dayCell);
            }
            return headerRow;
        }

        function createDraggableName(name, type, data = {}) {
            const el = document.createElement('div');
            el.draggable = true;
            el.addEventListener('dragstart', (e) => handleDragStart(e, name, type, data));
            el.addEventListener('dragend', handleDragEnd);

            const nameSpan = document.createElement('span');
            nameSpan.textContent = name;

            const staffMember = staffMembers.find(s => s.name === name);

            if (type === 'cell' && staffMember) {
                el.className = 'w-full h-full flex items-center justify-center rounded-md text-sm font-medium transition-all';
                el.style.backgroundColor = staffMember.color;
                el.style.color = getContrastingTextColor(staffMember.color);
                el.appendChild(nameSpan);
            } else if (type === 'palette') {
                el.className = 'p-2 rounded-md font-medium text-center transition-all flex justify-between items-center group';
                if (name === 'Remove') {
                    el.classList.add('bg-red-200', 'text-red-800');
                    el.appendChild(nameSpan);
                } else if (staffMember) {
                    el.classList.add('bg-gray-200', 'text-gray-800');
                    el.appendChild(nameSpan);

                    const controlsWrapper = document.createElement('div');
                    controlsWrapper.className = 'flex items-center gap-2';

                    const colorPickerLabel = document.createElement('label');
                    colorPickerLabel.className = 'relative w-6 h-6 rounded-full border-2 border-white shadow-sm cursor-pointer';
                    colorPickerLabel.style.backgroundColor = staffMember.color;

                    const colorInput = document.createElement('input');
                    colorInput.type = 'color';
                    colorInput.value = staffMember.color;
                    colorInput.className = 'absolute inset-0 w-full h-full opacity-0 cursor-pointer';

                    colorInput.addEventListener('input', (e) => {
                        colorPickerLabel.style.backgroundColor = e.target.value;
                    });
                    colorInput.addEventListener('change', (e) => {
                        staffMember.color = e.target.value;
                        render();
                    });

                    colorPickerLabel.appendChild(colorInput);
                    controlsWrapper.appendChild(colorPickerLabel);

                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity';
                    removeBtn.innerHTML = `<i data-lucide="x" class="w-4 h-4"></i>`;
                    removeBtn.onclick = (e) => {
                        e.stopPropagation();
                        handleRemoveStaff(name);
                    };
                    controlsWrapper.appendChild(removeBtn);
                    el.appendChild(controlsWrapper);
                }
            }
            return el;
        }
        
        function createDroppableCell(rowIndex, colIndex) {
            const cell = document.createElement('div');
            const name = rosterData.schedule[rowIndex][colIndex];
            cell.className = `h-16 flex items-center justify-center p-1 border-b border-r border-gray-200 transition-colors`;
            
            cell.addEventListener('dragover', handleDragOver);
            cell.addEventListener('dragleave', handleDragLeave);
            cell.addEventListener('drop', (e) => handleDrop(e, rowIndex, colIndex));

            if (name) {
                const data = { rowIndex, colIndex };
                const nameEl = createDraggableName(name, 'cell', data);
                cell.appendChild(nameEl);
            }
            return cell;
        }

        // --- Event Handlers ---
        function handleAddStaff(e) {
            e.preventDefault();
            const newName = newStaffNameInput.value.trim();
            const newColor = newStaffColorInput.value;
            if (newName && !staffMembers.some(staff => staff.name === newName)) {
                staffMembers.push({ name: newName, color: newColor });
                staffMembers.sort((a, b) => a.name.localeCompare(b.name));
                render();
            }
            newStaffNameInput.value = '';
        }

        function handleRemoveStaff(nameToRemove) {
            staffMembers = staffMembers.filter(staff => staff.name !== nameToRemove);
            rosterData.schedule = rosterData.schedule.map(row => 
                row.map(name => (name === nameToRemove ? '' : name))
            );
            render();
        }

        function handleDragStart(e, name, type, data) {
            draggedItem = { name, type, data };
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', name);
            setTimeout(() => e.target.closest('[draggable="true"]').classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            const draggable = e.target.closest('[draggable="true"]');
            if(draggable) draggable.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetCell = e.target.closest('div[class*="border-b"]');
            if (targetCell) {
                targetCell.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
             const targetCell = e.target.closest('div[class*="border-b"]');
            if (targetCell) {
                targetCell.classList.remove('drag-over');
            }
        }

        function handleDrop(e, targetRowIndex, targetColIndex) {
            e.preventDefault();
            const targetCell = e.target.closest('div[class*="border-b"]');
            if (targetCell) {
                targetCell.classList.remove('drag-over');
            }

            if (!draggedItem) return;

            const newName = draggedItem.name === 'Remove' ? '' : draggedItem.name;

            if (draggedItem.type === 'cell') {
                const origin = draggedItem.data;
                rosterData.schedule[origin.rowIndex][origin.colIndex] = '';
            }
            
            rosterData.schedule[targetRowIndex][targetColIndex] = newName;
            render();
        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            datePicker.addEventListener('change', (e) => {
                rosterData.startDate = e.target.value;
                render();
            });
            addStaffForm.addEventListener('submit', handleAddStaff);
            render();
        });

    </script>
</body>
</html>

