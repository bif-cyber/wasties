<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roster App</title>
  <!-- Load Tailwind CSS for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom CSS for visual polish and mobile responsiveness */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
    
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f3f4f6;
        padding: 1rem;
        color: #1f2937;
    }
    .roster-container {
        max-width: 1024px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: #ffffff;
        border-radius: 1rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 0.75rem;
        overflow: hidden;
    }
    th, td {
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
        text-align: center;
    }
    th {
        background-color: #f9fafb;
        font-weight: 600;
        color: #4b5563;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    tr:last-child td {
        border-bottom: none;
    }
    .roster-shift {
        cursor: grab;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        background-color: #22c55e;
        color: white;
        font-weight: 500;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease-in-out;
    }
    .roster-shift:hover {
        transform: translateY(-2px);
    }
    .roster-cell {
        min-height: 48px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .sortable-ghost {
      opacity: 0.4;
    }
  </style>
</head>
<body>

  <div class="roster-container">
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">Weekly Roster</h1>
    <div id="roster-table-container"></div>
  </div>
  
  <!-- Sortable.js library for drag-and-drop -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <script>
    // --- Roster Data (Simulates your spreadsheet data) ---
    // This data is hard-coded into the script and will not be saved on refresh.
    let rosterData = [
      { Date: "Mon 2025-09-08", Staff: "Chrissy", Shift: "Shop", Role: "Supervisor" },
      { Date: "Mon 2025-09-08", Staff: "Jodie", Shift: "Shop", Role: "Staff" },
      { Date: "Mon 2025-09-08", Staff: "Emma", Shift: "Shop", Role: "Staff" },
      { Date: "Mon 2025-09-08", Staff: "Zack", Shift: "Yard", Role: "Supervisor" },
      { Date: "Mon 2025-09-08", Staff: "Simon", Shift: "Yard", Role: "Staff" },
      { Date: "Mon 2025-09-08", Staff: "Jen", Shift: "Yard", Role: "Staff" },
      { Date: "Tue 2025-09-09", Staff: "Chrissy", Shift: "Yard", Role: "Staff" },
      { Date: "Tue 2025-09-09", Staff: "Simon", Shift: "Yard", Role: "Supervisor" }
    ];

    // --- Core Roster Rendering Function ---
    function renderRoster() {
      // 1. Get unique dates and staff names from the data
      const dates = [...new Set(rosterData.map(r => r.Date))].sort();
      const staff = [...new Set(rosterData.map(r => r.Staff))].sort();

      // 2. Build the HTML string for the table
      let html = `<table class="min-w-full divide-y divide-gray-200 shadow-sm"><thead><tr><th class="px-6 py-3">Staff</th>`;
      dates.forEach(d => html += `<th class="px-6 py-3">${d}</th>`);
      html += `</tr></thead><tbody class="bg-white divide-y divide-gray-200">`;

      staff.forEach(s => {
        html += `<tr><td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${s}</td>`;
        dates.forEach(d => {
          // Find the shift for the current staff and date
          const shift = rosterData.find(r => r.Date === d && r.Staff === s);
          const content = shift ? `${shift.Shift} (${shift.Role})` : "";
          
          // Add a data attribute for the cell's staff and date
          html += `<td class="px-6 py-4 roster-cell" data-date="${d}" data-staff="${s}">${content ? `<div class="roster-shift">${content}</div>` : ""}</td>`;
        });
        html += `</tr>`;
      });

      html += `</tbody></table>`;
      
      // 3. Insert the table HTML into the page
      document.getElementById("roster-table-container").innerHTML = html;

      // 4. Initialize drag-and-drop on all cells
      initSortable();
    }

    // --- Drag-and-Drop Initialization ---
    function initSortable() {
      document.querySelectorAll('.roster-cell').forEach(el => {
        new Sortable(el, {
          group: 'shared',
          animation: 150,
          onAdd: function (evt) {
            // Get the new cell's attributes from the droppable container
            const newDate = evt.to.getAttribute("data-date");
            const newStaff = evt.to.getAttribute("data-staff");

            // Get the old cell's attributes from the draggable item's parent
            const oldDate = evt.from.getAttribute("data-date");
            const oldStaff = evt.from.getAttribute("data-staff");
            
            // Extract the shift and role from the moved item's text
            const content = evt.item.innerText.trim();
            const parts = content.split(" (");
            const shift = parts[0];
            const role = parts[1] ? parts[1].replace(")", "") : "";
            
            // --- Update the Data Structure ---
            // 1. Remove the old shift
            rosterData = rosterData.filter(r => !(r.Date === oldDate && r.Staff === oldStaff));
            
            // 2. Add the new shift with the updated date and staff
            rosterData.push({
              Date: newDate,
              Staff: newStaff,
              Shift: shift,
              Role: role
            });

            // 3. Re-render the entire table to reflect the change
            renderRoster();
          }
        });
      });
    }

    // --- Initial Page Load ---
    // Start the process by rendering the roster when the page is loaded.
    document.addEventListener('DOMContentLoaded', renderRoster);
  </script>

</body>
</html>
